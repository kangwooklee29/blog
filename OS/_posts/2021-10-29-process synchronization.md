### 1. race condition

\- 특정 메모리 주소에 있는 변수 하나의 값을 서로 다른 프로세스 또는 서로 다른 CPU(multiprocessor system일 경우)가 동시에 조작하는 경우(한쪽에서는 값을 증가시키고 다른 쪽에서는 값을 감소시키는 경우 등)가 있을 수 있다. 이처럼 한 메모리 주소의 값을 서로 다른 주체가 변경하고자 하는 상황을 race condition이라 한다.

\- 예를 들어 프로세스 A가 한 변수의 값을 가져가 이를 증가시키는 연산을 하고 결과값을 저장하러 왔는데, 그 사이에 프로세스 B가 그 변수의 값을 감소시키는 연산을 하고 그 결과값을 먼저 저장해놓은 경우가 있을 수 있다. 이 경우 프로세스 A가 더 나중에 그 주소의 변수값을 변경했으므로, 프로세스 B가 그 변수의 값을 감소시킨 사실은 메모리 기록에서 사라지게 된다. 이처럼 race condition에서는 synchronize가 중요한 문제가 된다.


### 2. race condition에 대한 커널의 대처법

\- race condition은 커널과 관련해서 흔히 일어나는 상황이므로(일반적인 사용자 프로세스는 각자 메모리의 독립된 영역만을 사용하므로 race condition은 일반적인 사용자 프로세스에서 흔히 일어나는 상황은 아니다), 커널과 관련된 race condition을 유형별로 알아보고 그에 대한 대처법을 먼저 확인할 수 있다.

#### 1) 커널의 CPU 점유 중 interrupt가 발생한 경우

\- 커널의 CPU 점유 중 interrupt가 발생하면 커널은 연산을 중단하고 interrupt 처리 루틴을 수행해야 하는데, interrupt 발생 전 값을 변경하고자 한 변수가 있어 **그 값을 읽어온 상태일 때 interrupt가 발생**했고 interrupt 처리 루틴 수행 과정에서 먼저 그 값을 변경하는 경우가 있을 수 있다. 

\- 이 경우, interrupt가 발생했다 하더라도 **일단 하던 연산을 계속 수행하게 한 후 그 연산이 끝나면 그제야 interrupt 처리 루틴을 수행**하게 하는 식으로 race condition을 해결할 수 있다.

#### 2) 프로세스가 I/O 장치 접근 위해 커널을 호출한 상황에서 timer interrupt가 발생한 경우

\- 프로세스 A가 I/O 장치 접근을 위해 커널을 호출한 상황에서 timer interrupt가 발생한 경우에, 그 다음 프로세스인 프로세스 B도 수행 도중 I/O 장치 접근을 위해 커널을 호출해 두 프로세스에서 모두 커널을 호출했고 또 커널이 호출된 각 상황에서 동일한 변수의 값을 변경하는 경우가 있을 수 있다.

\- 이 경우, interrupt가 발생했다 하더라도 **커널 모드에 있다면 일단 하던 연산을 계속 수행하게 한 후 그 연산이 끝나면 그제야 context switch**를 하게 하는 식으로 race condition을 해결할 수 있다.

#### 3) multiprocessor 환경에서 공유 메모리 상의 커널 영역의 변수를 사용하는 경우

\- 이 경우는 interrupt가 발생하는 상황이 아니므로 'interrupt가 발생했다 하더라도 일단 하던 연산을 계속 수행하게 한다'는 식으로는 문제를 해결할 수 없다.

\- 다음 두 방법으로 race condition을 해결할 수 있다.

(1) 커널을 사용하는 CPU는 한 번에 하나만 허용한다.

(2) 커널이 shared memory에 접근할 때마다 그 데이터에 lock을 걸어 다른 CPU가 그 데이터에 접근한다 하더라도 값을 변경할 수 없게 한다.



### 3. critical-section problem

\- 프로세스가 공유 데이터를 사용하는 경우, 그 프로세스의 코드 중에는 공유 데이터에 접근하는 코드가 있기 마련이다(이를 critical section이라 한다). 현재 수행하는 프로세스 코드가 critical section에 진입할 때, 공유 데이터에 lock을 걸어 도중에 interrupt가 일어난다 하더라도 현재 프로세스가 lock을 건 공유 데이터는 사용 못하게 하는 식으로 race condition을 해결할 수 있다.