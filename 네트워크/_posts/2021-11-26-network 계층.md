---
title: Network 계층과 IP
---

### 1. network 계층의 forwarding

\- network 계층에서는 transport 계층에서 전달받은 세그먼트를 패킷에 담아 이를 다른 네트워크 장치로 보내 최종적으로 그 세그먼트의 목적 네트워크 장치로 보내게 된다.

\- network 계층에서는 **forwarding table**이 구현돼 있어(이 구현은 별도의 알고리즘을 통해 이루어진다), 수신한 패킷의 목적지(IP 주소)를 forwarding table에서 참조하여 forwarding table에 쓰인 **그 패킷이 보내져야 할 알맞은 link 인터페이스**로 그 패킷을 보내게 된다. 

\- 모든 IP 주소마다 개별적으로 그에 해당하는 link 번호를 저장해 두면 forwarding table이 매우 커지게 되므로 forwarding table은 그렇게 구현되어 있지는 않고, 'IP 주소가 이 범위에 해당되면 **(이러한 prefix를 가지면)** x번 link로 보낸다' 라는 식으로 구현되어 있다.

\- 구체적으로, forwarding table의 각 항목은 키값으로 그에 해당하는 IP 주소의 prefix가 저장돼 있어, 현재 라우터가 수신한 패킷의 dest IP 주소가 어떤 항목의 prefix와 일치하는지를 찾아 그에 해당하는 link 번호로 그 패킷을 보내게 된다. 이때, 예를 들어 어떤 항목의 prefix는 0101이고 어떤 항목의 prefix는 010100인데 라우터가 수신한 패킷의 dest IP 주소가 01010001이라면 어떤 prefix의 link 인터페이스를 선택해야 할지 문제가 된다. 일반적으로는 일치하는 길이가 더 긴 prefix를 선택한다(longest prefix matching).


### 2. 패킷의 헤더

\- 패킷의 헤더에는 다음과 같은 필드가 있다.

- IP version: 현재 사용되는 IP의 버전은 4이다.

- source IP 주소

- destination IP 주소

- time to live: 패킷이 네트워크 망 위에 무한루프를 도는 것을 방지하기 위해, IP를 지나가는 모든 패킷에는 '그 패킷이 지나칠 수 있는 라우터 개수'가 할당된다. 예를 들어 time to live가 15로 설정된 패킷은 라우터를 15개 지나가면 사라진다.

- upper layer: 그 패킷에 담긴 세그먼트가 TCP인지 UDP인지를 나타내며, 이 패킷을 수신한 리시버는 이 필드를 참조하여 패킷을 TCP에 올릴지 UDP에 올릴지를 결정한다.

\- 한 패킷에서 헤더가 차지하는 부분은 20B로 정해져 있고, 세그먼트의 헤더가 차지하는 부분은 20B로 정해져 있다. 따라서 패킷 하나가 갖는 오버헤드의 크기는 40B이다. 인터넷 망을 오가는 상당수 패킷이 크기가 40B인데, 이는 그 패킷이 ACK 메시지를 담고 있는 패킷이기 때문이다.


