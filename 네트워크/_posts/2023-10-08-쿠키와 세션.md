---
title: 쿠키와 세션
---


### 1. 쿠키

\- 1994년 당시 미국의 통신사 MCI는 온라인 쇼핑 웹서비스를 개발하고 있었고, 그 중에서는 쇼핑 카트 기능이 있었다. 당시 MCI는 클라이언트가 서버에 접속했을 때 각 클라이언트에 관한 정보를 서버쪽이 아니라 클라이언트에 저장하는 걸 바랐기 때문에, 당시 웹 브라우저를 개발하고 있었던 넷스케이프 측에 이 요청을 전달했다. 원래 HTTP는 stateless하게 구현돼있기 때문에 이러한 기능을 구현할 수 없었다. 이에 넷스케이프는 첫 베타버전에서부터 '쿠키'라는 개념을 도입하여 이를 구현했다. 이 '쿠키'라는 이름은, 당시 이미 유닉스에서 프로그램 간 통신 시 전송되던 패킷을 지칭하는 용어로 널리 사용되던 'magic cookie'라는 용어에서 따온 것이다. 

\- stateless한 HTTP의 특성은 웹서버의 구현이라는 측면에서는 편리하나 웹 서비스 운영사 측 입장에서는 여러 방문자에게 개인화 서비스를 제공할 수 없어 일종의 한계점인데, 쿠키의 도입으로 이의 극복이 가능해졌다. 따라서 웹을 통한 영업이 사실상 필수가 된 최근에 들어서 쿠키는 대다수 웹사이트에서 거의 반드시 사용하는 기술이 되었다. 이러한 웹사이트에서는 클라이언트로부터 첫 웹페이지 요청을 받게 되면 그 첫 HTTP 응답 메시지의 헤더에 `Set-Cookie`라는 필드를 포함시켜 쿠키를 발급한다. 이때 이 필드를 통해 쿠키를 수신한 클라이언트의 브라우저는 이를 클라이언트의 PC에 파일 형태로 저장했다가, 이후 그 웹페이지에서 추가로 HTTP 응답 요청 메시지를 전송할 때 해당 쿠키 내용을 그 헤더의 `Cookie` 필드에 담아 전송한다. 이렇게 되면 서버는 서버에 접속한 각 클라이언트를 식별할 수 있으며, 이를 통해 서버에서 stateless한 HTTP에도 불구하고 stateful한 통신을 할 수 있다.

\- 서버로부터 발급받은 쿠키에는 만료 날짜가 있는 쿠키가 있고 없는 쿠키가 있는데, 만료 날짜가 있는 쿠키는 '영구 쿠키'라 하며 이러한 쿠키는 브라우저를 종료하더라도 삭제되지 않고 있다 설정된 만료 날짜에 도달하면 자동으로 삭제되고 없는 쿠키는 '세션 쿠키'라 하며 사용자의 웹 브라우저 창이나 탭이 닫힐 때 소멸한다(일부 브라우저의 경우 완전히 종료하기 전까지 세션 쿠키가 유지될 수 있다). 사용자가 웹 브라우저의 설정을 통해 수동으로 쿠키를 삭제/변경하는 것도 가능하다. 또한, 클라이언트로부터 쿠키와 함께 HTTP 메시지를 수신한 서버가 클라이언트의 쿠키를 강제로 만료시키는 쿠키를 보내는 경우도 있다.


### 2. 쿠키의 형식

```
Set-Cookie: username=JohnDoe
Set-Cookie: sessionId=abc123xyz; Path=/; Secure
Set-Cookie: language=en; Path=/; Expires=Wed, 09 Jun 2024 10:18:14 GMT
...
```

\- 하나의 쿠키는 `Set-Cookie` 필드 하나에 담긴 메시지 내용으로 그 내용이 정해진다. `;`를 기준으로 쿠키의 내용이 구분되는데, 맨 앞에 오는 식의 `=` 앞부분은 그 쿠키의 이름이고 그 뒷부분은 그 쿠키가 갖는 값을 뜻한다.

  - `Path`: 그 쿠키가 유효한 그 도메인 내 경로 범위를 나타낸다. 생략 가능하나, 이 경우 쿠키는 현재 문서의 경로를 기본값으로 사용한다. 즉, 그 경로 및 그 하위 경로에서만 그 쿠키가 유효하게 된다.

  - `Expires`: 그 쿠키의 만료 기간을 뜻한다.

  - `Secure`: HTTPS로 접속한 경우에만 그 쿠키를 전송하도록 하는 플래그.

\- RFC 6265 표준에 따르면, 브라우저는 한 도메인당 총 50개, 모든 도메인에 대해 최소 300개의 쿠키를 저장할 수 있어야 한다. 쿠키 하나의 최대 크기는 4096 바이트(약 4KB)로 제한된다. 다만 브라우저가 항상 이 표준을 따르리라 기대하는 것은 부적절하며 너무 많은 쿠키를 사용하는 것은 서버-클라이언트 사이 통신 성능에도 악영향이 있다. 따라서 되도록 다른 클라이언트 측 저장 메커니즘(localStorage 등)을 고려할 필요가 있다.


### 3. 세션

\- 네트워크 관련해서 '세션'이라 함은 흔히 양 컴퓨터 사이 유한한 수명을 갖는 네트워크 연결을 뜻하며, 물리적 개념이라기보단 논리적 개념이다. 특히 웹에서는 서버-클라이언트 사이 연결을 뜻하는데, stateless한 HTTP 프로토콜의 특성으로 인해 그 개념이 클라이언트의 브라우저에 저장되는 세션 쿠키를 매개로 서버에서 구현된다. 일반적으로 세션의 수명을 관리하는 것은 전적으로 서버이지만, 클라이언트의 브라우저에 저장되는 쿠키의 값이 유지돼야 정확한 세션의 개념이 성립하는 바, 브라우저의 종료 등으로 인해 세션 쿠키가 소멸하면 사실상 그 세션은 종료된다.

\- 구체적으로, stateful한 통신을 구현하기 위해 일반적으로 웹서버는 클라이언트로부터 HTTP 요청을 받으면 그 클라이언트를 위한 세션을 생성하고 그 세션을 식별할 수 있는 특별한 토큰을 생성해 이를 클라이언트에 쿠키로서 전송한다. 이때 클라이언트는 이를 세션 쿠키로서 브라우저에 저장하며, 그 후 그 브라우저가 종료되기 전까지 그 웹서버에 HTTP 요청을 할 때 그 쿠키를 함께 전송한다. 이때 웹서버는 그 클라이언트의 HTTP 요청 메시지에 담긴 쿠키를 통해 그 클라이언트의 세션을 확인하고 그 클라이언트에 관한 과거 정보를 활용하여 그 클라이언트를 위한 적절한 응답 메시지를 생성 및 전송한다.

\- 이처럼 웹서버가 생성한 세션 토큰은 서버가 클라이언트를 식별하는 고유한 식별자인 바, 그 세션 토큰 값이 곧 서버에서 그 클라이언트임을 인증하는 일종의 인증키라 할 수 있다. 따라서 만약 예를 들어 어떤 웹서버에 아이디와 비밀번호를 입력하여 로그인한 후에 신용카드 비밀번호 등 중요한 정보를 그 서버에 저장했다면, 이와 같은 상황에서 세션 토큰이 제3자에게 유출되는 것은 심각한 보안사고로서 즉시 관련 정보가 제3자에게 유출된 것과 다름없다. 그러므로 브라우저를 사용하는 사람들은 중요한 웹사이트에 접속해서 로그인한 다음에는 이러한 세션 토큰 값이 유출되지 않도록 주의를 기울여야 하며, 보안에 의심이 가는 브라우저는 함부로 사용하지 않도록 굉장히 조심해야 한다. (대부분의 믿을 수 있는 브라우저는 쿠키에 의심스러운 프로그램이 함부로 접근하지 못하도록 특별한 조치를 취하고 있다.) 또한 HTTP 프로토콜은 암호화 없이 평문으로 메시지를 전송하기 때문에 이러한 세션 토큰이 제3자에 의해 탈취되기 쉬우므로, 중요한 정보를 사용하는 웹사이트를 사용할 땐 반드시 HTTPS 프로토콜을 통해 그 웹사이트에 접속해야 한다.

\- 세션을 통해 stateful한 통신이 구현돼있는 웹서버는 모두 쿠키를 사용하므로, 만약 어떤 웹사이트에서 쿠키를 사용할 것을 동의했다면 이는 내가 그 웹사이트에 접속한 한 세션 동안 했던 여러 활동에 관한 기록을 그 서버가 수집하는 것에 동의한 것과 같다. 이것이 일반 웹서비스 수요자에 대한 서비스 공급자의 지나친 개인정보 수집이 될 수 있음을 우려하여, 미국 캘리포니아 주와 EU에서는 웹사이트가 쿠키 같은 사용자 추적 기술을 사용하기에 앞서 반드시 사용자의 명시적 동의를 받도록 강제하는 CCPA, GDPR 등 법률을 입법하였고 세계적으로 이러한 법률 입법이 계속 이루어지고 있는 추세다.
